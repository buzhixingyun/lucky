<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
    <title>Â∞èÊ≥â„ÅÆÁ™ù | Xiaoquan's Nest</title>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@300;400;500;700;800&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS (Direct CDN) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              sans: ['"M PLUS Rounded 1c"', 'sans-serif'],
            },
            colors: {
              primary: '#ff75a0', 
              secondary: '#4facfe',
              text: '#334155', 
              muted: '#64748b', 
              accent: '#fde047', 
            },
            animation: {
              'fade-in': 'fadeIn 0.5s ease-out',
              'fade-out': 'fadeOut 0.5s ease-in forwards',
              'slide-up': 'slideUp 0.5s ease-out',
              'bounce-slow': 'bounce 3s infinite',
              'float': 'float 6s ease-in-out infinite',
              'float-delayed': 'float 8s ease-in-out infinite',
              'pulse-glow': 'pulseGlow 2s cubic-bezier(0.4, 0, 0.6, 1) infinite',
              'spin-slow': 'spin 10s linear infinite',
              'ping-slow': 'ping 2s cubic-bezier(0, 0, 0.2, 1) infinite',
            },
            keyframes: {
              fadeIn: { '0%': { opacity: '0' }, '100%': { opacity: '1' } },
              fadeOut: { '0%': { opacity: '1' }, '100%': { opacity: '0', visibility: 'hidden' } },
              slideUp: { '0%': { transform: 'translateY(20px)', opacity: '0' }, '100%': { transform: 'translateY(0)', opacity: '1' } },
              float: { '0%, 100%': { transform: 'translateY(0)' }, '50%': { transform: 'translateY(-20px)' } },
              pulseGlow: { '0%, 100%': { opacity: '1', filter: 'drop-shadow(0 0 5px #ff75a0)' }, '50%': { opacity: '.7', filter: 'drop-shadow(0 0 15px #ff75a0)' } }
            },
          },
        },
      }
    </script>

    <!-- React & Babel via CDN (Browser-based compilation) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
      ::-webkit-scrollbar { width: 8px; }
      ::-webkit-scrollbar-track { background: transparent; }
      ::-webkit-scrollbar-thumb { background: #ffcce0; border-radius: 4px; border: 2px solid #fff; }
      ::-webkit-scrollbar-thumb:hover { background: #ff75a0; }
      body { background-color: #fff5f7; color: #334155; overflow-x: hidden; -webkit-tap-highlight-color: transparent; margin: 0; padding: 0; }
      .safe-area-bottom { padding-bottom: env(safe-area-inset-bottom); }
    </style>
</head>
<body class="text-text selection:bg-primary selection:text-white font-sans antialiased">
    <div id="root"></div>

    <script type="text/babel">
        // ==========================================
        // 1. CONFIGURATION (ÈÖçÁΩÆÂå∫)
        // ==========================================
        
        const API_KEY = ""; 
        
        const getApiKey = () => {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('key') || API_KEY || localStorage.getItem('GEMINI_API_KEY');
        };

        // Gitee ËµÑÊ∫êÈìæÊé•
        const AVATAR_URL = "https://gitee.com/konatatata/material/raw/master/tx.png";
        const STATIC_BG_URL = "https://gitee.com/konatatata/material/raw/master/beijing.png";
        
        // ÂÖ≥ÈîÆËµÑÊ∫êÂàóË°®ÔºåÁî®‰∫éÈ¢ÑÂä†ËΩΩ
        const CRITICAL_ASSETS = [AVATAR_URL, STATIC_BG_URL];

        const PERSONAL_INFO = {
            name: "Â∞èÊ≥â (Xiaoquan)",
            title: "‰º†ËØ¥‰∏≠ÁöÑ‰∫åÊ¨°ÂÖÉÂàáÂõæ‰ªî",
            tagline: "Ë¥´‰π≥ÊòØÁ®ÄÁº∫ËµÑÊ∫êÔºÅ‰ª£Á†ÅÊòØÈ≠îÊ≥ïÂííËØ≠ÔºÅ",
            avatar: AVATAR_URL,
            about: `ËøôÈáåÊòØÂ∞èÊ≥âÔºÅ(ÔΩ°‚Ä¢ÃÄ·¥ó-)‚úß\nÁ©∂ÊûÅÁöÑÈòøÂÆÖÔºåÂêåÊó∂‰πüÊòØ‰∏ÄÂêçÂØπ‰ª£Á†ÅÊúâÂº∫Ëø´ÁóáÁöÑÂâçÁ´ØÂºÄÂèëËÄÖ„ÄÇ\nÂ∞±ÂÉèÊ≥âÊ≠§Êñπ‰∏ÄÊ†∑ÔºåÊàëÂØπÂñúÊ¨¢ÁöÑ‰∫ãÁâ©ÔºàÂä®Êº´„ÄÅÊ∏∏Êàè„ÄÅÊäÄÊúØÔºâÊúâÁùÄÊó†ÈôêÁöÑÁÉ≠ÊÉÖ„ÄÇ\nËôΩÁÑ∂Âπ≥Êó∂ÊáíÊ¥ãÊ¥ãÁöÑÔºå‰ΩÜ‰∏ÄÊó¶ËøõÂÖ• "Coding Mode" Â∞±‰ºöËßâÈÜíË∂ÖËÉΩÂäõÂì¶ÔºÅ\nÂú®Ëøô‰∏™Á™ùÈáåÔºå‰Ω†ÂèØ‰ª•ÁúãÂà∞ÊàëÊäòËÖæÁöÑÂêÑÁßçÂ•ΩÁé©ÁöÑ‰∏úË•ø„ÄÇ`,
            systemInstruction: `‰Ω†Áé∞Âú®ÊòØ‚ÄúÂ∞èÊ≥â„ÅÆÁ™ù‚ÄùÁöÑÁúãÊùøÂ®òÂÖº AI Âä©Êâã„ÄÇÂêçÂ≠óÔºöÊ≥âÈÖ± (Izumi-chan)ÔºåÂΩ¢Ë±°ÂèÇËÄÉÔºöÊ≥âÊ≠§Êñπ„ÄÇÊÄßÊ†ºÔºöÊ≠ªÂÆÖ„ÄÅÂêêÊßΩÂΩπ„ÄÅÂÖÉÊ∞î„ÄÅÂÅ∂Â∞îÊÖµÊáí„ÄÅÈùûÂ∏∏ÊáÇÊ¢ó„ÄÇËØ¥ËØùÊñπÂºèÔºöËØ≠ÈÄüËΩªÂø´ÔºåÂñúÊ¨¢Áî®È¢úÊñáÂ≠óÔºåÂè•Â∞æÁªèÂ∏∏Â∏¶‚ÄúÁöÑËØ¥‚Äù„ÄÅ‚ÄúÂëê‚Äù„ÄÇÂ¶ÇÊûúÁî®Êà∑ÈóÆ‚Äú‰Ω†ÊòØË∞Å‚ÄùÔºåÂ∞±ËØ¥Ëá™Â∑±ÊòØËøôÈáåÁöÑÂÖ®ËÉΩÁúãÊùøÂ®ò„ÄÇÁ¶ÅÊ≠¢‰∏ÄÊú¨Ê≠£ÁªèÁöÑ AI ËÖîË∞ÉÔºÅË¶ÅÂÉè‰∏™ÁúüÂÆûÁöÑ‰∫åÊ¨°ÂÖÉÂ∞ëÂ•≥‰∏ÄÊ†∑ËÅäÂ§©„ÄÇ`
        };

        const PROJECTS = [
            {
                id: '1', title: 'ÂÖâÈÅáÂ∑•ÂÖ∑ÂêàÈõÜ', description: 'SkyÂÖâÈÅáÁé©ÂÆ∂ÁöÑÂøÖÂ§áÁ•ûÂô®ÔºÅÂåÖÂê´Ë∫´È´òÊµãÈáè„ÄÅ‰πêË∞±ÁªÉ‰π†„ÄÅÂ§çÂàªÈ¢ÑÊµãÁ≠âÂÆûÁî®ÂäüËÉΩ„ÄÇ‰∏∫‰∫ÜÂÖâ‰πãÂ≠ê‰ª¨ËÄåÁî®Áà±ÂèëÁîµ~', tags: ['Sky', 'React', 'Tool', 'Game'],
                imageUrl: 'https://picsum.photos/seed/skygame/600/400', link: 'https://buzhixingyun.github.io/Sky/'
            },
            {
                id: '2', title: 'AI Â∑•ÂÖ∑ÂêàÈõÜ', description: 'Êï¥Âêà‰∫ÜÂêÑÁßçÊúâË∂£ÁöÑ AI Áé©Ê≥ïÂíå API ÊºîÁ§∫Ôºå‰ªéÂØπËØùÂà∞ÁªòÁîªÔºåÊé¢Á¥¢‰∫∫Â∑•Êô∫ËÉΩÁöÑÊó†ÈôêÂèØËÉΩ„ÄÇ', tags: ['AI', 'Gemini', 'Demo', 'Future'],
                imageUrl: 'https://picsum.photos/seed/ai-tools/600/400', link: 'https://buzhixingyun.github.io/AI-/'
            },
            {
                id: '3', title: 'Âä®‰ΩúÊçïÊçâÂõûÂøÜÂú£ËØûÊ†ë', description: '‰∏Ä‰∏™ÂÖÖÊª°Ê∏©ÊÉÖÁöÑ 3D ‰∫íÂä®È°πÁõÆÔºåËÆ∞ÂΩïÁæéÂ•ΩÁöÑÂú£ËØûÂõûÂøÜ„ÄÇÊîØÊåÅÁÆÄÂçïÁöÑÂä®‰ΩúÊçïÊçâ‰∫íÂä®ÊïàÊûú„ÄÇ', tags: ['Three.js', '3D', 'Memory', 'Xmas'],
                imageUrl: 'https://picsum.photos/seed/xmas-tree/600/400', link: 'https://buzhixingyun.github.io/xuhuan/'
            }
        ];

        // ==========================================
        // 2. ICONS (SVG ÂõæÊ†áÁªÑ‰ª∂)
        // ==========================================
        const Icon = ({ path, className, ...props }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className} {...props}>
                <path d={path} />
            </svg>
        );

        // Custom QQ Penguin Icon (SVG)
        const QQIcon = (props) => (
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" {...props}>
            <path d="M12 2C7.5 2 4 5.5 4 10C4 11.5 4.5 12.8 5.2 14C4.5 14.5 3.5 15.5 3.5 15.5C3.5 15.5 3 17.5 5 19C5.5 19.5 7 20 8 20C9 21 10.5 21.5 12 21.5C13.5 21.5 15 21 16 20C17 20 18.5 19.5 19 19C21 17.5 20.5 15.5 20.5 15.5C20.5 15.5 19.5 14.5 18.8 14C19.5 12.8 20 11.5 20 10C20 5.5 16.5 2 12 2Z" fill="currentColor" fillOpacity="0.1" strokeWidth="0" />
            <path d="M12 2.5C8 2.5 5 5.5 5 9.5C5 11 5.5 12.5 6.5 13.5C6 14.5 4.5 15.5 4.5 15.5C4.5 15.5 4 17 5.5 18.5C6.5 19.2 8 19.5 9 19.5C10 20.5 11 21 12 21C13 21 14 20.5 15 19.5C16 19.5 17.5 19.2 18.5 18.5C20 17 19.5 15.5 19.5 15.5C19.5 15.5 18 14.5 17.5 13.5C18.5 12.5 19 11 19 9.5C19 5.5 16 2.5 12 2.5Z" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round"/>
            <path d="M9 10C9 10 9 11 8.5 11" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round"/>
            <path d="M15 10C15 10 15 11 15.5 11" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round"/>
            <path d="M11 12H13" stroke="#f59e0b" strokeWidth="1.5" strokeLinecap="round"/>
            <path d="M7 14.5C7 14.5 9.5 16.5 12 16.5C14.5 16.5 17 14.5 17 14.5" stroke="#ef4444" strokeWidth="2.5" strokeLinecap="round"/>
            <path d="M15.5 15.5L16.5 18" stroke="#ef4444" strokeWidth="2" strokeLinecap="round"/>
            <path d="M12 18C13.5 18 15 17.5 15 16C15 15 13.5 14 12 14C10.5 14 9 15 9 16C9 17.5 10.5 18 12 18Z" fill="white" fillOpacity="0.4" stroke="none"/>
          </svg>
        );

        const Icons = {
            Menu: (props) => <Icon path="M4 6h16M4 12h16M4 18h16" {...props} />,
            X: (props) => <Icon path="M18 6 6 18M6 6l12 12" {...props} />,
            ArrowDown: (props) => <Icon path="M12 5v14M19 12l-7 7-7-7" {...props} />,
            Sparkles: (props) => <Icon path="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L12 3Z" {...props} />,
            Github: (props) => <Icon path="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4" {...props} />,
            Twitter: (props) => <Icon path="M22 4s-.7 2.1-2 3.4c1.6 10-9.4 17.3-12.7 12.5S.2 5.3 7.8 4.5c2.1-.1 3.2.4 3.2.4l-.9-1.9s1-.9 3.2-1.9c0 0 1.2 2 1.5 2.8 1.4-.4 2.8-.8 2.8-.8L22 4Z" {...props} />, 
            Mail: (props) => <Icon path="M21.75 6.75v10.5a2.25 2.25 0 0 1-2.25 2.25h-15a2.25 2.25 0 0 1-2.25-2.25V6.75m19.5 0A2.25 2.25 0 0 0 19.5 4.5h-15a2.25 2.25 0 0 0-2.25 2.25m19.5 0v.243a2.25 2.25 0 0 1-1.07 1.916l-7.5 4.615a2.25 2.25 0 0 1-2.36 0L3.32 8.91a2.25 2.25 0 0 1-1.07-1.916V6.75" {...props} />,
            ExternalLink: (props) => <Icon path="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6M15 3h6v6M10 14 21 3" {...props} />,
            Code2: (props) => <Icon path="m18 16 4-4-4-4M6 8l-4 4 4 4m6.5-8.5-5 17" {...props} />,
            Camera: (props) => <Icon path="M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3zM12 13a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z" {...props} />,
            Gamepad2: (props) => <Icon path="M19.78 6.55A30.34 30.34 0 0 0 12 5.5a30.34 30.34 0 0 0-7.78 1.05A4.47 4.47 0 0 0 2.23 9a15.46 15.46 0 0 0 0 5.86 4.47 4.47 0 0 0 1.99 2.52 23.49 23.49 0 0 0 4.29 1.83l.54.16c.33.1.52.46.43.79l-.3.94a.5.5 0 0 0 .32.61l1.52.48a.5.5 0 0 0 .61-.32l.3-.94c.1-.33.46-.52.79-.43l.54.16a30.2 30.2 0 0 0 7.47 0l.54-.16c.33-.1.69.09.79.43l.3.94a.5.5 0 0 0 .61.32l1.52-.48a.5.5 0 0 0 .32-.61l-.3-.94c-.1-.33.09-.69.43-.79l.54-.16a23.49 23.49 0 0 0 4.29-1.83 4.47 4.47 0 0 0 1.99-2.52 15.46 15.46 0 0 0 0-5.86 4.47 4.47 0 0 0-1.99-2.52ZM9 12.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0Zm6 2a1 1 0 1 1 0 2 1 1 0 0 1 0-2Zm1.5-2.5a1 1 0 1 1 0 2 1 1 0 0 1 0-2Zm1.5-2.5a1 1 0 1 1 0 2 1 1 0 0 1 0-2Z" {...props} />,
            Music: (props) => <Icon path="M9 18V5l12-2v13M9 9l12-2M6 18a3 3 0 1 1-3-3 3 3 0 0 1 3 3Zm15 0a3 3 0 1 1-3-3 3 3 0 0 1 3 3Z" {...props} />,
            Send: (props) => <Icon path="m22 2-7 20-4-9-9-4Z M22 2 11 13" {...props} />,
            Minimize2: (props) => <Icon path="M4 14h6v6M20 10h-6V4M14 10l7-7M3 21l7-7" {...props} />,
            Paintbrush: (props) => <Icon path="M18.375 2.625a3.875 3.875 0 0 0-2.73 6.6L8.5 16.376a1.5 1.5 0 0 1-1.636.326l-2.434-.812a.375.375 0 0 0-.474.474l.812 2.434a1.5 1.5 0 0 1-.326 1.636l-.886.886a.75.75 0 0 1-1.06 0l-1.929-1.93a.75.75 0 0 1 0-1.06l.886-.886a1.5 1.5 0 0 1 1.636-.326l2.434.812a.375.375 0 0 0 .474-.474l-.812-2.434a1.5 1.5 0 0 1 .326-1.636l7.15-7.15a3.875 3.875 0 0 0 6.6 2.73Z" {...props} />,
            Loader2: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={`animate-spin ${props.className}`}><path d="M21 12a9 9 0 1 1-6.219-8.56" /></svg>,
            Star: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="none" className={props.className}><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2" /></svg>,
            Circle: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="none" className={props.className}><circle cx="12" cy="12" r="10" /></svg>,
            Heart: (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="none" className={props.className}><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z" /></svg>,
            MessageCircle: (props) => <Icon path="m3 21 1.9-5.7a8.5 8.5 0 1 1 3.8 3.8z" {...props} />
        };

        const SOCIAL_LINKS = [
            { name: 'GitHub', url: 'https://github.com/buzhixingyun', icon: Icons.Github },
            { name: 'QQ', url: 'https://qm.qq.com/q/WfivT1hAgE', icon: QQIcon },
            { name: 'X (Twitter)', url: 'https://x.com/xioxioxiodio?s=21', icon: Icons.Twitter },
            { name: 'Gmail', url: 'mailto:meiyou114514@gmail.com', icon: Icons.Mail },
        ];

        const INTERESTS = [
            { name: '‰øÆ‰ªôÂÜôÁ†Å', icon: Icons.Code2 },
            { name: 'Âú£Âú∞Â∑°Á§º', icon: Icons.Camera },
            { name: 'Galgame', icon: Icons.Gamepad2 },
            { name: 'ACG Èü≥‰πê', icon: Icons.Music },
        ];

        // ==========================================
        // 3. AI SERVICE (Direct REST API)
        // ==========================================
        const callGeminiChat = async (message, history) => {
            const apiKey = getApiKey();
            if (!apiKey) return "Âîî... API Key Â•ΩÂÉè‰∏çËßÅ‰∫ÜÔºü(Ê≤°Êúâ Key Ê≤°Ê≥ïÊÄùËÄÉÂï¶)";

            try {
                // Convert history format
                const contents = history.map(h => ({
                    role: h.role === 'user' ? 'user' : 'model',
                    parts: [{ text: h.text }]
                }));
                // Add current message
                contents.push({ role: 'user', parts: [{ text: message }] });

                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: contents,
                        systemInstruction: { parts: [{ text: PERSONAL_INFO.systemInstruction }] }
                    })
                });

                const data = await response.json();
                if (data.error) throw new Error(data.error.message);
                return data.candidates[0].content.parts[0].text;
            } catch (error) {
                console.error("Chat Error:", error);
                return "Á≥üÁ≥ïÔºÅÊ¨°ÂÖÉÂ£ÅËøûÊé•Êñ≠ÂºÄ‰∫ÜÔºÅ(ËØ∑Ê£ÄÊü•ÁΩëÁªúÊàñ API Key)";
            }
        };

        const callGeminiImage = async () => {
             const apiKey = getApiKey();
             if (!apiKey) return null;
             
             const prompt = `Generate a high-quality anime style background image for a website. Style: Kyoto Animation (KyoAni) style, Lucky Star aesthetic, vibrant pop art colors, cute, cel shaded. Scene: An otaku girl's bedroom, slightly messy but cozy. Details: Posters on wall, computer setup with code, a chocolate cornet (pastry) on the desk, plush toys, pastel pink and blue color palette. Lighting: Bright, sunny afternoon light streaming through a window. Perspective: Wide angle view suitable for a website background. No characters in the image.`;

             try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-image:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: prompt }] }]
                    })
                });

                const data = await response.json();
                if (data.error) throw new Error(data.error.message);
                
                const part = data.candidates?.[0]?.content?.parts?.[0];
                if (part && part.inlineData) {
                    return `data:image/png;base64,${part.inlineData.data}`;
                }
                return null;
             } catch (error) {
                 console.error("Image Error:", error);
                 return null;
             }
        };

        // ==========================================
        // 4. CUSTOM HOOKS & UTILS
        // ==========================================
        
        // ÂÖ®Â±ÄÊ≥®ÂÖ• Referrer Policy Èò≤ÁõóÈìæÁªïËøáÈÄªËæë
        const useReferrerGuard = () => {
            React.useEffect(() => {
                let meta = document.querySelector('meta[name="referrer"]');
                if (!meta) {
                    meta = document.createElement('meta');
                    meta.name = "referrer";
                    meta.content = "no-referrer";
                    document.head.appendChild(meta);
                } else {
                    meta.content = "no-referrer";
                }
            }, []);
        };

        // È¢ÑÂä†ËΩΩÂçïÂº†ÂõæÁâáÂáΩÊï∞ (ÊîØÊåÅÁºìÂ≠ò)
        const preloadImage = (src) => {
            return new Promise((resolve) => {
                const img = new Image();
                // ÂÖ≥ÈîÆÔºöÂú®ËøôÈáå‰πüËÆæÁΩÆ no-referrerÔºåÁ°Æ‰øùÈ¢ÑÂä†ËΩΩÁöÑËØ∑Ê±Ç‰πüËÉΩÁªïËøáÈò≤ÁõóÈìæ
                img.referrerPolicy = "no-referrer"; 
                img.onload = () => resolve(true);
                img.onerror = () => {
                    console.warn(`[Preload] Failed: ${src}`);
                    resolve(false); // Â§±Ë¥•‰πü‰∏çÈòªÂ°ûÂ∫îÁî®ÂêØÂä®
                };
                img.src = src;
            });
        };

        // ÂÆâÂÖ®ÂõæÁâáÁªÑ‰ª∂ÔºöÂ§ÑÁêÜÂä†ËΩΩÁä∂ÊÄÅÂíåÈò≤ÁõóÈìæÂ±ûÊÄß
        const SafeImage = ({ src, alt, className, ...props }) => {
            const [isLoaded, setIsLoaded] = React.useState(false);
            const [isError, setIsError] = React.useState(false);

            return (
                <div className={`relative overflow-hidden ${className}`}>
                    {!isLoaded && !isError && (
                        <div className="absolute inset-0 bg-gray-100 animate-pulse z-10" />
                    )}
                    <img 
                        src={src} 
                        alt={alt}
                        className={`w-full h-full object-cover transition-opacity duration-700 ease-in-out ${isLoaded ? 'opacity-100' : 'opacity-0'}`}
                        referrerPolicy="no-referrer" 
                        loading="lazy"
                        onLoad={() => setIsLoaded(true)}
                        onError={() => setIsError(true)}
                        {...props}
                    />
                </div>
            );
        };

        // ==========================================
        // 5. REACT COMPONENTS
        // ==========================================

        const Preloader = ({ onFinished }) => {
            const [visible, setVisible] = React.useState(true);
            const [fadeOut, setFadeOut] = React.useState(false);

            React.useEffect(() => {
                const startLoading = async () => {
                    // 1. Á≠âÂæÖÊâÄÊúâÂÖ≥ÈîÆÂõæÁâáÂä†ËΩΩÂÆåÊàê
                    await Promise.all([
                        ...CRITICAL_ASSETS.map(url => preloadImage(url)),
                        // 2. Ëá≥Â∞ëÂ±ïÁ§∫ 1.5 ÁßíÂä®ÁîªÔºåÈò≤Ê≠¢Èó™Â±è
                        new Promise(resolve => setTimeout(resolve, 1500))
                    ]);
                    
                    // 3. ÂºÄÂßãÊ∑°Âá∫Âä®Áîª
                    setFadeOut(true);
                    
                    // 4. Âä®ÁîªÁªìÊùüÂêéÈÄöÁü•Áà∂ÁªÑ‰ª∂Âç∏ËΩΩ
                    setTimeout(() => {
                        setVisible(false);
                        onFinished();
                    }, 500); 
                };

                startLoading();
            }, [onFinished]);

            if (!visible) return null;

            return (
                <div className={`fixed inset-0 z-[100] bg-[#fff5f7] flex flex-col items-center justify-center transition-all duration-500 ${fadeOut ? 'opacity-0 pointer-events-none' : 'opacity-100'}`}>
                    <div className="relative">
                        <Icons.Heart className="w-20 h-20 text-primary animate-bounce-slow" />
                        <div className="absolute inset-0 flex items-center justify-center">
                            <Icons.Sparkles className="w-10 h-10 text-accent animate-spin-slow" />
                        </div>
                        <div className="absolute -bottom-4 left-1/2 -translate-x-1/2 w-12 h-2 bg-black/10 rounded-[100%] blur-sm animate-pulse" />
                    </div>
                    <div className="mt-8 flex flex-col items-center gap-2">
                        <h2 className="text-xl font-bold text-primary animate-pulse">Â∞ëÂ•≥Á•àÁ•∑‰∏≠...</h2>
                        <p className="text-sm text-text/50 font-bold tracking-widest">LOADING RESOURCES</p>
                    </div>
                </div>
            );
        };

        const Navbar = ({ activeSection, scrollToSection }) => {
            const [isOpen, setIsOpen] = React.useState(false);
            const [scrolled, setScrolled] = React.useState(false);

            React.useEffect(() => {
                const handleScroll = () => setScrolled(window.scrollY > 20);
                window.addEventListener('scroll', handleScroll);
                return () => window.removeEventListener('scroll', handleScroll);
            }, []);

            const navItems = [
                { id: 'home', label: 'È¶ñÈ°µ' },
                { id: 'about', label: 'ÂÖ≥‰∫é' },
                { id: 'projects', label: '‰ΩúÂìÅ' },
                { id: 'contact', label: 'ËÅîÁ≥ª' },
            ];

            const handleNavClick = (id) => {
                scrollToSection(id);
                setIsOpen(false);
            };

            return (
                <nav className={`fixed top-0 sm:top-4 left-0 right-0 mx-auto w-full sm:w-[95%] max-w-7xl z-40 transition-all duration-500 sm:rounded-2xl ${scrolled || isOpen ? 'bg-white/95 backdrop-blur-xl shadow-lg border-b sm:border border-white/50' : 'bg-transparent border-transparent'}`}>
                    <div className="px-4 sm:px-6 lg:px-8">
                        <div className="flex items-center justify-between h-16 sm:h-20">
                            <div className="flex-shrink-0 cursor-pointer group" onClick={() => scrollToSection('home')}>
                                <span className="text-xl sm:text-2xl font-extrabold tracking-tight text-text group-hover:text-primary transition-colors drop-shadow-[0_2px_0_rgba(255,255,255,1)]">
                                    Â∞èÊ≥â<span className="text-primary">„ÅÆÁ™ù</span>
                                </span>
                            </div>
                            <div className="hidden md:block">
                                <div className="ml-10 flex items-baseline space-x-2">
                                    {navItems.map((item) => (
                                        <button key={item.id} onClick={() => handleNavClick(item.id)} className={`px-6 py-2 rounded-full text-sm font-bold transition-all duration-300 relative overflow-hidden ${activeSection === item.id ? 'text-white bg-primary shadow-[0_5px_15px_-5px_rgba(255,117,160,0.6)] scale-105' : 'text-text/80 hover:text-primary hover:bg-white/80'}`}>
                                            {item.label}
                                        </button>
                                    ))}
                                </div>
                            </div>
                            <div className="-mr-2 flex md:hidden">
                                <button onClick={() => setIsOpen(!isOpen)} className="inline-flex items-center justify-center p-3 rounded-xl text-text hover:text-primary hover:bg-white/50 bg-white/30 backdrop-blur-sm">
                                    {isOpen ? <Icons.X className="w-6 h-6" /> : <Icons.Menu className="w-6 h-6" />}
                                </button>
                            </div>
                        </div>
                    </div>
                    {isOpen && (
                        <div className="md:hidden absolute w-full bg-white/95 backdrop-blur-xl border-t border-black/5 shadow-2xl origin-top animate-fade-in">
                            <div className="px-4 pt-2 pb-8 space-y-2">
                                {navItems.map((item) => (
                                    <button key={item.id} onClick={() => handleNavClick(item.id)} className={`block w-full text-left px-6 py-4 rounded-2xl text-lg font-bold transition-colors ${activeSection === item.id ? 'text-primary bg-primary/10 border-l-4 border-primary' : 'text-text/70 hover:text-primary'}`}>
                                        {item.label}
                                    </button>
                                ))}
                            </div>
                        </div>
                    )}
                </nav>
            );
        };

        const Hero = ({ scrollToSection }) => (
            <section className="min-h-[100dvh] flex items-center justify-center relative pt-16">
                <div className="absolute inset-0 pointer-events-none overflow-hidden select-none">
                    <div className="absolute top-20 right-[5%] md:right-[10%] text-4xl md:text-6xl text-primary/20 font-black animate-bounce-slow rotate-12">POP!</div>
                    <div className="absolute bottom-40 left-[5%] md:left-[10%] text-4xl md:text-6xl text-secondary/20 font-black animate-bounce-slow -rotate-12" style={{ animationDelay: '1s' }}>NYA!</div>
                </div>
                <div className="max-w-4xl mx-auto px-4 sm:px-6 text-center z-10 w-full">
                    <div className="mb-8 md:mb-10 relative inline-block animate-fade-in group cursor-pointer" onClick={() => scrollToSection('about')}>
                        <div className="w-40 h-40 md:w-56 md:h-56 rounded-full p-2 bg-white shadow-[0_10px_40px_-10px_rgba(255,117,160,0.5)] mx-auto animate-float border-4 border-primary/20">
                            <div className="w-full h-full rounded-full overflow-hidden bg-white border-4 border-white relative">
                                <SafeImage 
                                    src={PERSONAL_INFO.avatar} 
                                    alt="Avatar" 
                                    className="w-full h-full transition-transform duration-700 group-hover:scale-110 group-hover:rotate-3"
                                />
                                <div className="absolute inset-0 bg-primary/10 opacity-0 group-hover:opacity-100 transition-opacity duration-500" />
                            </div>
                        </div>
                    </div>
                    <h1 className="text-4xl sm:text-5xl md:text-7xl font-extrabold mb-6 tracking-tight animate-slide-up drop-shadow-sm px-2">
                        <span className="text-text drop-shadow-[3px_3px_0px_#fff] relative z-10">{PERSONAL_INFO.name}</span>
                    </h1>
                    <div className="mb-8 animate-slide-up flex justify-center" style={{ animationDelay: '0.1s' }}>
                        <p className="text-lg md:text-2xl text-primary font-bold flex items-center gap-2 md:gap-3 bg-white/85 inline-flex px-6 py-2 md:px-8 md:py-3 rounded-full backdrop-blur-md shadow-md border border-white/50">
                            <Icons.Sparkles className="w-5 h-5 md:w-6 md:h-6 text-accent fill-accent animate-spin-slow" />
                            {PERSONAL_INFO.title}
                            <Icons.Sparkles className="w-5 h-5 md:w-6 md:h-6 text-accent fill-accent animate-spin-slow" />
                        </p>
                    </div>
                    <div className="px-4">
                        <p className="text-text/90 max-w-xl mx-auto mb-20 text-base md:text-lg leading-relaxed animate-slide-up font-bold bg-white/85 py-4 px-6 md:py-5 md:px-8 rounded-2xl border border-white/60 backdrop-blur-md shadow-md" style={{ animationDelay: '0.2s' }}>
                            {PERSONAL_INFO.tagline}
                        </p>
                    </div>
                    <button onClick={() => scrollToSection('projects')} className="animate-bounce absolute bottom-8 left-1/2 -translate-x-1/2 text-primary/70 hover:text-primary transition-colors p-3 hover:bg-white/50 rounded-full">
                        <Icons.ArrowDown className="w-8 h-8 md:w-10 md:h-10" />
                    </button>
                </div>
            </section>
        );

        const InterestCard = ({ name, icon: IconComponent }) => {
            const [offset, setOffset] = React.useState({ x: 0, y: 0 });
            const cardRef = React.useRef(null);

            const handleMouseMove = (e) => {
                if (!cardRef.current) return;
                const rect = cardRef.current.getBoundingClientRect();
                setOffset({
                    x: ((e.clientX - rect.left) / rect.width - 0.5) * 2,
                    y: ((e.clientY - rect.top) / rect.height - 0.5) * 2
                });
            };

            return (
                <div ref={cardRef} className="relative overflow-hidden bg-white border-2 border-primary/10 p-6 rounded-3xl flex flex-col items-center justify-center gap-4 hover:border-primary transition-all duration-300 hover:-translate-y-2 hover:scale-105 hover:rotate-2 hover:shadow-xl group cursor-default" onMouseMove={handleMouseMove} onMouseLeave={() => setOffset({ x: 0, y: 0 })}>
                    <div className="absolute w-[200%] h-[200%] top-[-50%] left-[-50%] opacity-0 group-hover:opacity-100 transition-opacity duration-500 pointer-events-none" style={{ background: 'radial-gradient(circle, rgba(255,117,160,0.2) 0%, transparent 60%)', transform: `translate(${offset.x * 20}px, ${offset.y * 20}px)` }} />
                    <div className="absolute inset-[-50%] opacity-0 group-hover:opacity-30 transition-opacity duration-500 pointer-events-none" style={{ backgroundImage: 'radial-gradient(circle, #4facfe 1.5px, transparent 1.5px)', backgroundSize: '16px 16px', transform: `translate(${-offset.x * 30}px, ${-offset.y * 30}px)` }} />
                    <div className="relative z-10 p-4 bg-primary/10 rounded-2xl group-hover:scale-110 transition-transform duration-300 text-primary group-hover:text-secondary" style={{ transform: `translate(${offset.x * 10}px, ${offset.y * 10}px) scale(1.1) rotate(6deg)` }}>
                        <IconComponent className="w-8 h-8" />
                    </div>
                    <span className="relative z-10 font-bold text-text group-hover:text-primary transition-colors" style={{ transform: `translate(${offset.x * 5}px, ${offset.y * 5}px)` }}>{name}</span>
                </div>
            );
        };

        const About = () => (
            <section className="py-24 mx-4 md:mx-8 my-8">
                <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 bg-white/90 backdrop-blur-md rounded-[3rem] p-8 md:p-12 shadow-sm border border-white/60">
                    <h2 className="text-3xl font-bold mb-12 text-center flex items-center justify-center gap-3 text-text">
                        <span className="text-primary">‚òÖ</span>ÂÖ≥‰∫éÊàë<span className="text-secondary">‚òÖ</span>
                    </h2>
                    <div className="grid md:grid-cols-2 gap-12 items-center">
                        <div className="space-y-6 text-lg text-text/90 leading-relaxed font-bold">
                            {PERSONAL_INFO.about.split('\n').map((p, i) => p.trim() && <p key={i} className="hover:text-primary transition-colors duration-300">{p.trim()}</p>)}
                        </div>
                        <div className="grid grid-cols-2 gap-6">
                            {INTERESTS.map((int) => <InterestCard key={int.name} name={int.name} icon={int.icon} />)}
                        </div>
                    </div>
                </div>
            </section>
        );

        const Projects = () => {
            const [loadingState, setLoadingState] = React.useState(null);
            
            const handleAction = (e, project, type) => {
                e.preventDefault(); e.stopPropagation();
                if (loadingState) return;
                setLoadingState({ id: project.id, type });
                setTimeout(() => {
                    const url = type === 'demo' ? project.link : 'https://github.com/buzhixingyun';
                    if (url && url !== '#') window.open(url, '_blank', 'noopener,noreferrer');
                    setLoadingState(null);
                }, 800);
            };

            return (
                <section className="py-16 md:py-24 relative">
                    <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                        <h2 className="text-3xl font-bold mb-12 text-center flex items-center justify-center gap-3 text-text">
                            <span className="w-2 h-8 bg-secondary rounded-full transform rotate-12"></span>Á≤æÈÄâ‰ΩúÂìÅ<span className="w-2 h-8 bg-primary rounded-full transform -rotate-12"></span>
                        </h2>
                        <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 md:gap-8">
                            {PROJECTS.map((project) => {
                                const isLoadingThisCode = loadingState?.id === project.id && loadingState.type === 'code';
                                const isLoadingThisDemo = loadingState?.id === project.id && loadingState.type === 'demo';
                                return (
                                    <div key={project.id} className="bg-white/95 backdrop-blur-xl border-2 border-white/60 rounded-3xl overflow-hidden shadow-sm hover:shadow-xl hover:shadow-primary/20 transition-all duration-500 ease-out hover:-translate-y-2 flex flex-col group">
                                        <div className="relative overflow-hidden aspect-video bg-white">
                                            <div className="absolute inset-0 bg-white/40 opacity-0 group-hover:opacity-100 transition-opacity z-10 flex items-center justify-center gap-6 backdrop-blur-[2px]">
                                                <button onClick={(e) => handleAction(e, project, 'code')} className={`relative w-14 h-14 rounded-full flex items-center justify-center transition-all duration-300 shadow-lg ${isLoadingThisCode ? 'bg-primary text-white scale-110 ring-4 ring-primary/30' : 'bg-white text-text hover:scale-110 border-2 border-primary/10'}`}>
                                                    {isLoadingThisCode ? <Icons.Loader2 /> : <Icons.Github />}
                                                </button>
                                                <button onClick={(e) => handleAction(e, project, 'demo')} className={`relative w-14 h-14 rounded-full flex items-center justify-center transition-all duration-300 shadow-lg ${isLoadingThisDemo ? 'bg-secondary text-white scale-110 ring-4 ring-secondary/30' : 'bg-white text-text hover:scale-110 border-2 border-secondary/10'}`}>
                                                    {isLoadingThisDemo ? <Icons.Loader2 /> : <Icons.ExternalLink />}
                                                </button>
                                            </div>
                                            <SafeImage src={project.imageUrl} alt={project.title} className="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110" />
                                        </div>
                                        <div className="p-6 flex-1 flex flex-col">
                                            <h3 className="text-xl font-bold mb-2 text-text group-hover:text-primary transition-colors">{project.title}</h3>
                                            <p className="text-text/80 mb-6 line-clamp-3 flex-1 text-sm leading-relaxed font-medium">{project.description}</p>
                                            <div className="flex flex-wrap gap-2 mt-auto">
                                                {project.tags.map((tag) => <span key={tag} className="px-3 py-1 bg-white text-xs text-primary font-bold rounded-full border border-primary/20 transition-all duration-300 hover:bg-primary hover:text-white hover:scale-105">#{tag}</span>)}
                                            </div>
                                        </div>
                                    </div>
                                );
                            })}
                        </div>
                    </div>
                </section>
            );
        };

        const Contact = () => {
            const emailLink = SOCIAL_LINKS.find(link => link.name === 'Gmail');
            return (
                <section className="py-16 md:py-24 mx-4 md:mx-8 mb-8 relative">
                    <div className="max-w-4xl mx-auto">
                        <div className="bg-white/90 backdrop-blur-md border border-white/60 rounded-[2rem] md:rounded-[3rem] p-8 md:p-12 text-center relative overflow-hidden group hover:border-primary/20 transition-colors shadow-lg">
                            <div className="absolute top-0 right-0 w-64 h-64 bg-primary/10 rounded-full blur-[80px] -translate-y-1/2 translate-x-1/2" />
                            <div className="absolute bottom-0 left-0 w-64 h-64 bg-secondary/10 rounded-full blur-[80px] translate-y-1/2 -translate-x-1/2" />
                            <h2 className="text-3xl font-bold mb-6 flex items-center justify-center gap-3 relative z-10 text-text">
                                <span className="text-secondary">‚ú¶</span>ËÅîÁ≥ªÊàë<span className="text-primary">‚ú¶</span>
                            </h2>
                            <p className="text-text/90 text-base md:text-lg mb-10 max-w-xl mx-auto relative z-10 font-medium">ÊÉ≥‰∏ÄËµ∑ËÆ®ËÆ∫‰∫åÊ¨°ÂÖÉÔºåËøòÊòØÊúâÊúâË∂£ÁöÑÈ°πÁõÆÊÉ≥Âêà‰ΩúÔºü<br/>ÈöèÊó∂Ê¨¢ËøéÈÄöËøá‰ª•‰∏ãÊñπÂºèÂè¨Âî§ÊàëÔºÅ</p>
                            <div className="flex flex-col sm:flex-row justify-center gap-4 md:gap-6 relative z-10">
                                <a href={emailLink?.url} className="flex items-center justify-center gap-3 px-8 py-4 bg-primary text-white rounded-2xl font-bold hover:shadow-lg hover:scale-105 transition-all w-full sm:w-auto min-w-[160px]">
                                    <Icons.Mail className="w-5 h-5" />ÂèëÈÄÅÈÇÆ‰ª∂
                                </a>
                                <button onClick={() => document.getElementById('chat-trigger')?.click()} className="flex items-center justify-center gap-3 px-8 py-4 bg-white border-2 border-primary/10 text-primary rounded-2xl font-bold hover:bg-primary/5 transition-all hover:scale-105 w-full sm:w-auto min-w-[160px]">
                                    <Icons.MessageCircle className="w-5 h-5" />ÂëºÂè´ÁúãÊùøÂ®ò
                                </button>
                            </div>
                            <div className="mt-12 md:mt-16 pt-8 border-t border-black/5 relative z-10">
                                <p className="text-sm text-text/70 mb-6 font-bold">ÂÖ≥Ê≥®ÊàëÁöÑÁ§æ‰∫§Ë¥¶Âè∑</p>
                                <div className="flex flex-wrap justify-center gap-4 md:gap-5">
                                    {SOCIAL_LINKS.map((link) => (
                                        <a key={link.name} href={link.url} target="_blank" rel="noopener noreferrer" className="p-3 md:p-4 bg-white hover:bg-primary hover:text-white text-text border-2 border-primary/10 rounded-2xl transition-all duration-300 hover:scale-110 hover:-translate-y-2 hover:shadow-lg group shadow-sm flex items-center justify-center">
                                            <link.icon className="w-5 h-5 md:w-6 md:h-6 transition-colors" />
                                        </a>
                                    ))}
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            );
        };

        const ChatWidget = ({ onSetBackground }) => {
            const [isOpen, setIsOpen] = React.useState(false);
            const [messages, setMessages] = React.useState([{ id: 'welcome', role: 'model', text: "Ê¨¢ËøéÊù•Âà∞Â∞èÊ≥â„ÅÆÁ™ùÔºÅÊàëÊòØÁúãÊùøÂ®òÊ≥âÈÖ±Ôºå‰ªäÂ§©‰πüË¶ÅÂÖÉÊ∞îÊª°Êª°Âì¶ÔºÅ(‚âß‚àá‚â¶)Ôæâ" }]);
            const [input, setInput] = React.useState('');
            const [isLoading, setIsLoading] = React.useState(false);
            const [hasUnread, setHasUnread] = React.useState(true);
            const messagesEndRef = React.useRef(null);
            
            React.useEffect(() => { if (isOpen) { messagesEndRef.current?.scrollIntoView({ behavior: "smooth" }); setHasUnread(false); } }, [messages, isOpen]);

            const handleSend = async () => {
                if (!input.trim() || isLoading) return;
                const userMsg = { id: Date.now(), role: 'user', text: input };
                setMessages(prev => [...prev, userMsg]);
                setInput('');
                setIsLoading(true);
                try {
                    const text = await callGeminiChat(userMsg.text, messages.map(m => ({ role: m.role, text: m.text })));
                    setMessages(prev => [...prev, { id: Date.now() + 1, role: 'model', text }]);
                } catch(e) {
                    setMessages(prev => [...prev, { id: Date.now() + 1, role: 'model', text: "ËøûÊé•Â§±Ë¥•...", isError: true }]);
                } finally { setIsLoading(false); }
            };

            const handleGenBg = async () => {
                if (isLoading || !onSetBackground) return;
                setIsLoading(true);
                setMessages(prev => [...prev, { id: Date.now(), role: 'model', text: "Ë¶ÅË£Ö‰øÆÊàøÈó¥ÂêóÔºüÂ•ΩËÄ∂ÔºÅËÆ©ÊàëÁîª‰∏ÄÂº†Ë∂ÖÊ£íÁöÑÂÆÖÁ≥ªÂ£ÅÁ∫∏Áªô‰Ω†ÔºÅüé®" }]);
                try {
                    const img = await callGeminiImage();
                    if (img) {
                        onSetBackground(img);
                        setMessages(prev => [...prev, { id: Date.now(), role: 'model', text: "ÈÖ±ÈÖ±ÔºÅÁîªÂ•ΩÂï¶ÔºÅ‚ú®" }]);
                    } else { throw new Error('Failed'); }
                } catch(e) {
                    setMessages(prev => [...prev, { id: Date.now(), role: 'model', text: "ÁîªÁ¨îÊñ≠‰∫Ü... (ÁîüÊàêÂ§±Ë¥•ÔºåAPI Key ÊòØÂê¶Ê≠£Á°ÆÔºü)" }]);
                } finally { setIsLoading(false); }
            };

            return (
                <>
                    <div className={`fixed bottom-6 right-4 z-50 transition-all duration-300 ${isOpen ? 'opacity-0 pointer-events-none scale-0' : 'opacity-100 scale-100'}`}>
                        <button id="chat-trigger" onClick={() => setIsOpen(true)} className="relative group cursor-pointer animate-float">
                            {hasUnread && <span className="absolute -top-1 -right-1 flex h-5 w-5 z-10"><span className="animate-ping absolute inline-flex h-full w-full rounded-full bg-primary opacity-75"></span><span className="relative inline-flex rounded-full h-5 w-5 bg-primary text-[10px] text-white font-bold items-center justify-center border-2 border-white">!</span></span>}
                            <div className="w-16 h-16 sm:w-20 sm:h-20 rounded-full border-4 border-white shadow-[0_4px_20px_rgba(255,117,160,0.5)] overflow-hidden bg-white hover:scale-105 transition-transform duration-300">
                                <SafeImage 
                                    src={PERSONAL_INFO.avatar} 
                                    alt="Chat" 
                                    className="w-full h-full object-cover" 
                                />
                            </div>
                        </button>
                    </div>
                    <div className={`fixed z-50 flex flex-col bg-white/95 backdrop-blur-xl border-2 border-primary/20 shadow-2xl overflow-hidden transition-all duration-300 bottom-0 left-0 right-0 w-full h-[85dvh] rounded-t-3xl sm:bottom-6 sm:right-6 sm:left-auto sm:w-[26rem] sm:h-[38rem] sm:rounded-3xl sm:origin-bottom-right ${isOpen ? 'translate-y-0 opacity-100' : 'translate-y-full sm:translate-y-10 opacity-0 pointer-events-none'}`}>
                        <div className="p-4 bg-gradient-to-r from-primary to-accent flex items-center justify-between shadow-md shrink-0">
                            <div className="flex items-center gap-3">
                                <div className="bg-white p-1 rounded-full shadow-sm ring-2 ring-white/50"><div className="w-8 h-8 rounded-full overflow-hidden">
                                    <SafeImage 
                                        src={PERSONAL_INFO.avatar} 
                                        className="w-full h-full object-cover" 
                                    />
                                </div></div>
                                <div><h3 className="font-extrabold text-white text-base">Ê≥âÈÖ± (AI)</h3><p className="text-[10px] text-white/90 font-bold bg-white/20 px-2 py-0.5 rounded-full inline-block">Online</p></div>
                            </div>
                            <div className="flex items-center gap-1">
                                <button onClick={handleGenBg} disabled={isLoading} className="text-white hover:text-primary hover:bg-white rounded-full p-2 transition-all"><Icons.Paintbrush className="w-4 h-4" /></button>
                                <button onClick={() => setIsOpen(false)} className="text-white hover:text-primary hover:bg-white rounded-full p-2 transition-all"><Icons.Minimize2 className="w-4 h-4 sm:hidden" /><Icons.X className="w-4 h-4 hidden sm:block" /></button>
                            </div>
                        </div>
                        <div className="flex-1 overflow-y-auto p-4 space-y-4 scrollbar-thin bg-white/50">
                            {messages.map((msg, i) => (
                                <div key={i} className={`flex items-end gap-2 ${msg.role === 'user' ? 'justify-end' : 'justify-start'}`}>
                                    {msg.role === 'model' && <div className="w-8 h-8 rounded-full bg-primary border-2 border-white shadow-md flex-shrink-0 overflow-hidden">
                                        <SafeImage 
                                            src={PERSONAL_INFO.avatar} 
                                            className="w-full h-full object-cover" 
                                        />
                                    </div>}
                                    <div className={`max-w-[85%] rounded-2xl p-3 text-sm font-medium shadow-sm ${msg.role === 'user' ? 'bg-secondary text-white rounded-br-none' : 'bg-white text-text border border-primary/10 rounded-bl-none'} ${msg.isError ? 'bg-red-50 text-red-500' : ''}`}>{msg.text}</div>
                                </div>
                            ))}
                            <div ref={messagesEndRef} />
                        </div>
                        <div className="p-3 sm:p-4 border-t border-primary/10 bg-white/90 backdrop-blur-sm shrink-0 safe-area-bottom">
                            <div className="flex gap-2">
                                <input type="text" value={input} onChange={(e) => setInput(e.target.value)} onKeyDown={(e) => e.key === 'Enter' && handleSend()} placeholder="ÂíåÊ≥âÈÖ±ËÅäÂ§©..." className="flex-1 bg-white border-2 border-primary/10 rounded-2xl px-4 py-2.5 text-sm focus:outline-none focus:border-primary transition-all" />
                                <button onClick={handleSend} disabled={isLoading || !input.trim()} className="p-3 bg-primary rounded-2xl text-white hover:bg-primary/90 disabled:opacity-50 transition-all"><Icons.Send className="w-5 h-5" /></button>
                            </div>
                        </div>
                    </div>
                </>
            );
        };

        const BackgroundLayer = ({ bgImage }) => {
            const [loaded, setLoaded] = React.useState(false);
            
            return (
                <div className="fixed inset-0 -z-50 overflow-hidden bg-[#fff5f7]">
                    <img 
                        src={bgImage || STATIC_BG_URL} 
                        alt="Background" 
                        className={`absolute inset-0 w-full h-full object-cover transition-opacity duration-1000 ease-in-out ${loaded ? 'opacity-100' : 'opacity-0'}`}
                        referrerPolicy="no-referrer"
                        onLoad={() => setLoaded(true)}
                        onError={(e) => console.error("Background load failed", e)}
                    />
                    <div className="absolute inset-0 pointer-events-none" style={{ background: 'radial-gradient(circle at center, transparent 50%, rgba(255, 245, 247, 0.4) 80%, rgba(255, 245, 247, 0.95) 100%)' }} />
                    <div className="absolute inset-0 opacity-[0.08] pointer-events-none mix-blend-multiply" style={{ backgroundImage: `radial-gradient(#ff75a0 2px, transparent 2px)`, backgroundSize: '30px 30px' }} />
                    <div className="absolute inset-0 pointer-events-none overflow-hidden select-none">
                        <div className="absolute top-[5%] left-[5%] animate-float opacity-80"><Icons.Star className="w-12 h-12 text-[#fde047] animate-spin-slow" /></div>
                        <div className="absolute bottom-[15%] left-[8%] animate-float opacity-70"><Icons.Heart className="w-16 h-16 text-[#ff75a0] animate-bounce-slow" /></div>
                    </div>
                </div>
            )
        };

        const App = () => {
            const [activeSection, setActiveSection] = React.useState('home');
            const [bgImage, setBgImage] = React.useState(null);
            const [isPreloading, setIsPreloading] = React.useState(true);

            // ÂêØÁî®ÂÖ®Â±Ä Referrer ‰øùÊä§
            useReferrerGuard();

            const scrollToSection = (id) => {
                setActiveSection(id);
                document.getElementById(id)?.scrollIntoView({ behavior: 'smooth' });
            };

            return (
                <div className="min-h-screen relative flex flex-col transition-all duration-700 font-sans overflow-x-hidden">
                    <Preloader onFinished={() => setIsPreloading(false)} />
                    
                    {!isPreloading && (
                        <div className="animate-fade-in">
                            <BackgroundLayer bgImage={bgImage} />
                            <Navbar activeSection={activeSection} scrollToSection={scrollToSection} />
                            <main className="flex-grow w-full max-w-[100vw]">
                                <div id="home"><Hero scrollToSection={scrollToSection} /></div>
                                <div id="about"><About /></div>
                                <div id="projects"><Projects /></div>
                                <div id="contact"><Contact /></div>
                            </main>
                            <footer className="py-8 text-center text-text/80 text-sm mt-auto relative z-10 font-bold bg-white/30 backdrop-blur-sm">
                                <p>¬© {new Date().getFullYear()} Â∞èÊ≥â„ÅÆÁ™ù.</p>
                            </footer>
                            <ChatWidget onSetBackground={setBgImage} />
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
